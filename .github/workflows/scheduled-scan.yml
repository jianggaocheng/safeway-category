name: Scheduled Auto Scan

on:
  # ÊØè 6 Â∞èÊó∂Ëá™Âä®ËøêË°å‰∏ÄÊ¨°
  schedule:
    - cron: '0 */6 * * *'  # ÊØèÂ§© 0:00, 6:00, 12:00, 18:00 UTC ËøêË°å
  
  # ‰πüÊîØÊåÅÊâãÂä®Ëß¶Âèë
  workflow_dispatch:
    inputs:
      reset_progress:
        description: 'ÈáçÁΩÆËøõÂ∫¶Ôºå‰ªéÂ§¥ÂºÄÂßã'
        required: false
        default: 'false'
        type: choice
        options:
          - 'false'
          - 'true'
      batch_size:
        description: 'ÊØèÊâπÊ¨°Â§ÑÁêÜÁöÑËåÉÂõ¥Â§ßÂ∞è (hex)'
        required: true
        default: '03000000'
      concurrency:
        description: 'Âπ∂ÂèëÊï∞'
        required: true
        default: '50'

jobs:
  check-and-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 350  # 5.8 Â∞èÊó∂
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Ëé∑ÂèñÂÆåÊï¥ÂéÜÂè≤‰ª•ËÆøÈóÆ‰πãÂâçÁöÑ artifacts

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Download previous progress
        id: download_progress
        continue-on-error: true
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            
            // Ëé∑ÂèñÊúÄËøëÁöÑ workflow runs
            const runs = await github.rest.actions.listWorkflowRuns({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'scheduled-scan.yml',
              per_page: 20,
              status: 'completed'
            });
            
            console.log(`Found ${runs.data.workflow_runs.length} completed runs`);
            
            // Êü•ÊâæÊúÄËøëÁöÑÊàêÂäüËøêË°åÁöÑ progress artifact
            for (const run of runs.data.workflow_runs) {
              try {
                const artifacts = await github.rest.actions.listWorkflowRunArtifacts({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  run_id: run.id,
                });
                
                const progressArtifact = artifacts.data.artifacts.find(a => a.name === 'scan-progress');
                
                if (progressArtifact) {
                  console.log(`Found progress artifact in run ${run.id}`);
                  
                  // ‰∏ãËΩΩ artifact
                  const download = await github.rest.actions.downloadArtifact({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    artifact_id: progressArtifact.id,
                    archive_format: 'zip',
                  });
                  
                  // ‰øùÂ≠òÂà∞Êñá‰ª∂
                  fs.writeFileSync('progress.zip', Buffer.from(download.data));
                  console.log('Progress artifact downloaded');
                  core.setOutput('found', 'true');
                  return;
                }
              } catch (error) {
                console.log(`Error checking run ${run.id}: ${error.message}`);
              }
            }
            
            console.log('No previous progress found');
            core.setOutput('found', 'false');

      - name: Extract progress
        if: steps.download_progress.outputs.found == 'true'
        run: |
          if [ -f progress.zip ]; then
            unzip -q progress.zip || true
            if [ -f progress.json ]; then
              echo "‚úÖ Previous progress restored:"
              cat progress.json
            fi
          fi

      - name: Determine current range
        id: calc_range
        run: |
          node << 'EOF'
          const fs = require('fs');
          
          const TOTAL_MAX = 'ffffffff';
          const batchSizeHex = process.env.BATCH_SIZE || '03000000';
          const resetProgress = process.env.RESET_PROGRESS === 'true';
          
          let startHex = '00000000';
          
          // Â¶ÇÊûú‰∏çÊòØÈáçÁΩÆÔºåÂ∞ùËØï‰ªé progress.json ËØªÂèñ
          if (!resetProgress && fs.existsSync('progress.json')) {
            try {
              const progress = JSON.parse(fs.readFileSync('progress.json', 'utf8'));
              const lastProcessedHex = progress.lastProcessedHex || progress.next_start || '00000000';
              const lastInt = parseInt(lastProcessedHex, 16);
              startHex = (lastInt + 1).toString(16).padStart(8, '0');
              console.log(`üìç Resuming from previous progress: ${lastProcessedHex} -> ${startHex}`);
            } catch (e) {
              console.log(`‚ö†Ô∏è  Could not read progress, starting from beginning: ${e.message}`);
            }
          } else if (resetProgress) {
            console.log('üîÑ Progress reset requested, starting from beginning');
          }
          
          const batchSize = parseInt(batchSizeHex, 16);
          const startInt = parseInt(startHex, 16);
          const maxInt = parseInt(TOTAL_MAX, 16);
          
          // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂÆåÊàê
          if (startInt > maxInt) {
            console.log('‚úÖ All ranges completed!');
            fs.appendFileSync(process.env.GITHUB_OUTPUT, `is_complete=true\n`);
            fs.appendFileSync(process.env.GITHUB_OUTPUT, `should_run=false\n`);
            fs.appendFileSync(process.env.GITHUB_OUTPUT, `start_hex=ffffffff\n`);
            fs.appendFileSync(process.env.GITHUB_OUTPUT, `end_hex=ffffffff\n`);
            return;
          }
          
          let endInt = startInt + batchSize - 1;
          let isComplete = false;
          
          if (endInt >= maxInt) {
            endInt = maxInt;
            isComplete = true;
          }
          
          const endHex = endInt.toString(16).padStart(8, '0');
          const nextStartInt = endInt + 1;
          const nextStartHex = nextStartInt > maxInt ? 'complete' : nextStartInt.toString(16).padStart(8, '0');
          
          // ËÆ°ÁÆóÊÄª‰ΩìËøõÂ∫¶
          const totalRange = maxInt + 1;
          const processedRange = endInt + 1;
          const progressPercent = ((processedRange / totalRange) * 100).toFixed(2);
          
          console.log(`\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó`);
          console.log(`‚ïë           Current Batch Configuration                 ‚ïë`);
          console.log(`‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`);
          console.log(`Range:    ${startHex} -> ${endHex}`);
          console.log(`Progress: ${progressPercent}%`);
          console.log(`Next:     ${nextStartHex}`);
          console.log(`Complete: ${isComplete}`);
          console.log(``);
          
          // ËæìÂá∫Âà∞ GitHub Actions
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `start_hex=${startHex}\n`);
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `end_hex=${endHex}\n`);
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `next_start=${nextStartHex}\n`);
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `is_complete=${isComplete}\n`);
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `progress_percent=${progressPercent}\n`);
          fs.appendFileSync(process.env.GITHUB_OUTPUT, `should_run=true\n`);
          EOF
        env:
          BATCH_SIZE: ${{ github.event.inputs.batch_size || '03000000' }}
          RESET_PROGRESS: ${{ github.event.inputs.reset_progress || 'false' }}

      - name: Check if should run
        if: steps.calc_range.outputs.should_run != 'true'
        run: |
          echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
          echo "‚ïë           üéâ ALL SCANS COMPLETED! üéâ                   ‚ïë"
          echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
          echo ""
          echo "All ranges from 00000000 to ffffffff have been processed!"
          echo ""
          
          echo "## üéâ All Scans Completed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "The entire range (00000000 to ffffffff) has been scanned!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "You can disable the scheduled workflow now." >> $GITHUB_STEP_SUMMARY

      - name: Install dependencies
        if: steps.calc_range.outputs.should_run == 'true'
        run: |
          if [ -f package.json ]; then
            npm install
          else
            npm install axios
          fi

      - name: Run scan
        if: steps.calc_range.outputs.should_run == 'true'
        run: |
          echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
          echo "‚ïë           Starting Batch Scan                          ‚ïë"
          echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
          echo ""
          echo "üìç Range: ${{ steps.calc_range.outputs.start_hex }} ‚Üí ${{ steps.calc_range.outputs.end_hex }}"
          echo "üìä Overall Progress: ${{ steps.calc_range.outputs.progress_percent }}%"
          echo "‚ö° Concurrency: ${{ github.event.inputs.concurrency || '50' }}"
          echo "‚è∞ Max runtime: 5.8 hours"
          echo "üîÑ Next scheduled run: in ~6 hours"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo ""
          
          # ÂêØÂä®ÂêéÂè∞ËøõÂ∫¶ÁõëÊéß
          (
            sleep 60
            while true; do
              if [ -f output/progress.json ]; then
                echo ""
                echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS UPDATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
                echo "Time: $(date '+%Y-%m-%d %H:%M:%S')"
                
                LAST_HEX=$(grep -o '"lastProcessedHex":"[^"]*"' output/progress.json | cut -d'"' -f4 || echo "?")
                PROCESSED=$(grep -o '"processedCount":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
                FOUND=$(grep -o '"foundCount":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
                RATE=$(grep -o '"avgRate":"[^"]*"' output/progress.json | cut -d'"' -f4 || echo "0")
                ELAPSED=$(grep -o '"elapsedSeconds":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
                
                echo "‚îú‚îÄ Batch: ${{ steps.calc_range.outputs.start_hex }} ‚Üí ${{ steps.calc_range.outputs.end_hex }}"
                echo "‚îú‚îÄ Current: $LAST_HEX"
                echo "‚îú‚îÄ Processed: $PROCESSED | Found: $FOUND"
                echo "‚îú‚îÄ Rate: $RATE req/s | Time: $((ELAPSED/3600))h $((ELAPSED%3600/60))m"
                echo "‚îú‚îÄ Overall: ${{ steps.calc_range.outputs.progress_percent }}%"
                echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
                echo ""
              fi
              sleep 300
            done
          ) &
          MONITOR_PID=$!
          
          # ËøêË°å‰∏ª‰ªªÂä°
          MAX_RUNTIME_SECONDS=20880 node fetch-category.js ${{ steps.calc_range.outputs.start_hex }} ${{ steps.calc_range.outputs.end_hex }} ${{ github.event.inputs.concurrency || '50' }}
          EXIT_CODE=$?
          
          # ÂÅúÊ≠¢ÁõëÊéß
          kill $MONITOR_PID 2>/dev/null || true
          
          echo ""
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "‚úÖ Batch completed with exit code: $EXIT_CODE"
          
          exit $EXIT_CODE

      - name: Save progress for next run
        if: always() && steps.calc_range.outputs.should_run == 'true'
        run: |
          # ÂàõÂª∫ËøõÂ∫¶Êñá‰ª∂
          cat > progress.json << EOF
          {
            "next_start": "${{ steps.calc_range.outputs.next_start }}",
            "last_batch_start": "${{ steps.calc_range.outputs.start_hex }}",
            "last_batch_end": "${{ steps.calc_range.outputs.end_hex }}",
            "progress_percent": "${{ steps.calc_range.outputs.progress_percent }}",
            "is_complete": "${{ steps.calc_range.outputs.is_complete }}",
            "last_run_time": "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
          }
          EOF
          
          # Â¶ÇÊûúÊúâÂÆûÈôÖÁöÑÊâ´ÊèèËøõÂ∫¶ÔºåÂêàÂπ∂ËøõÊù•
          if [ -f output/progress.json ]; then
            node << 'MERGE_EOF'
            const fs = require('fs');
            const savedProgress = JSON.parse(fs.readFileSync('progress.json', 'utf8'));
            const scanProgress = JSON.parse(fs.readFileSync('output/progress.json', 'utf8'));
            
            // ÂêàÂπ∂‰∏§‰∏™ËøõÂ∫¶Êñá‰ª∂
            const merged = {
              ...savedProgress,
              lastProcessedHex: scanProgress.lastProcessedHex,
              scan_processed: scanProgress.processedCount,
              scan_found: scanProgress.foundCount,
              scan_elapsed: scanProgress.elapsedSeconds,
              scan_avgRate: scanProgress.avgRate
            };
            
            fs.writeFileSync('progress.json', JSON.stringify(merged, null, 2));
            MERGE_EOF
          fi
          
          echo "‚úÖ Progress saved for next scheduled run"
          cat progress.json

      - name: Upload progress
        if: always() && steps.calc_range.outputs.should_run == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: scan-progress
          path: progress.json
          retention-days: 90

      - name: Upload batch results
        if: always() && steps.calc_range.outputs.should_run == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: batch-${{ steps.calc_range.outputs.start_hex }}-to-${{ steps.calc_range.outputs.end_hex }}
          path: output/
          retention-days: 90
          if-no-files-found: warn

      - name: Generate summary
        if: always() && steps.calc_range.outputs.should_run == 'true'
        run: |
          echo "## üìä Batch Scan Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Current Batch" >> $GITHUB_STEP_SUMMARY
          echo "- **Range:** \`${{ steps.calc_range.outputs.start_hex }}\` ‚Üí \`${{ steps.calc_range.outputs.end_hex }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Overall Progress:** ${{ steps.calc_range.outputs.progress_percent }}%" >> $GITHUB_STEP_SUMMARY
          echo "- **Next Start:** \`${{ steps.calc_range.outputs.next_start }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Complete:** ${{ steps.calc_range.outputs.is_complete }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f output/progress.json ]; then
            PROCESSED=$(grep -o '"processedCount":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
            FOUND=$(grep -o '"foundCount":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
            RATE=$(grep -o '"avgRate":"[^"]*"' output/progress.json | cut -d'"' -f4 || echo "0")
            ELAPSED=$(grep -o '"elapsedSeconds":[0-9]*' output/progress.json | grep -o '[0-9]*' || echo "0")
            
            echo "### This Batch Results" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Metric | Value |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
            echo "| üìä Processed | **${PROCESSED}** |" >> $GITHUB_STEP_SUMMARY
            echo "| ‚úÖ Found | **${FOUND}** |" >> $GITHUB_STEP_SUMMARY
            echo "| ‚ö° Rate | ${RATE} req/s |" >> $GITHUB_STEP_SUMMARY
            echo "| ‚è±Ô∏è  Runtime | $((ELAPSED/3600))h $((ELAPSED%3600/60))m $((ELAPSED%60))s |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            if [ "$FOUND" -gt "0" ]; then
              echo "<details>" >> $GITHUB_STEP_SUMMARY
              echo "<summary>‚úÖ Found Widgets (${FOUND})</summary>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo '```' >> $GITHUB_STEP_SUMMARY
              grep -o '"GR-C-Categ-[^"]*"' output/progress.json | tr -d '"' | nl >> $GITHUB_STEP_SUMMARY
              echo '```' >> $GITHUB_STEP_SUMMARY
              echo "</details>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
            fi
          fi
          
          if [ -f output/summary.txt ]; then
            echo "<details>" >> $GITHUB_STEP_SUMMARY
            echo "<summary>üìÑ Detailed Report</summary>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            cat output/summary.txt >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "</details>" >> $GITHUB_STEP_SUMMARY
          fi
          
          # ËøõÂ∫¶Êù°
          PROGRESS=${{ steps.calc_range.outputs.progress_percent }}
          PROGRESS_INT=${PROGRESS%.*}
          FILLED=$((PROGRESS_INT / 2))
          EMPTY=$((50 - FILLED))
          
          echo "### üìà Overall Progress" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          printf "["
          printf "%${FILLED}s" | tr ' ' '='
          printf "%${EMPTY}s" | tr ' ' '-'
          printf "] ${PROGRESS}%%\n"
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üîÑ **Next scheduled run:** in ~6 hours" >> $GITHUB_STEP_SUMMARY

